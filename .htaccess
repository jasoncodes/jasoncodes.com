RewriteEngine On

# no-www
RewriteCond %{HTTP_HOST} ^www\.(.*)$ [NC]
RewriteRule ^(.*)$ http://%1/$1 [R=301,L]

# redirect my name domain to my vanity domain
RewriteCond %{HTTP_HOST} ^jasonweathered\.com$ [NC]
RewriteRule ^(.*)$ http://jasoncodes.com/$1 [R=301,L]

# disable multiviews and directory listings
# we're going to use rewriting instead of MultiViews
Options -MultiViews -Indexes
DirectorySlash On

# our post receive hook's URL is /_deploy
# this week we're using PHP to handle it (fake MultiViews)
RewriteRule _deploy$ %{REQUEST_URI}.php

# redirect away /index from URLs
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteCond %{REQUEST_URI} (.*)/index$
RewriteRule .* %1/ [R=301]

# redirect /foo/bar/ for /foo/bar.html to /foo/bar
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} (.*)
RewriteCond %1.html -f
RewriteCond %{REQUEST_URI} (.*)/$
RewriteRule .* %1 [R=301]

# interpret /foo/bar as /foo/bar.html
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteCond %{REQUEST_URI} !/$
RewriteRule .* %{REQUEST_URI}.html [E=DONE:1]

# redirect away .html from URLs
RewriteCond %{ENV:REDIRECT_DONE} ^$
RewriteCond %{REQUEST_URI} (.*)\.html$
RewriteRule .* %1 [R=301]

# no caching on our text/html content (maybe later)
ExpiresActive On
ExpiresByType text/html "access"

# set content types for fonts and icons
AddType font/ttf ttf
AddType font/otf otf
AddType application/vnd.ms-fontobject eot
AddType image/vnd.microsoft.icon ico

